Feb 09 14:18:00 inf_ > Ininciando ejecución de: qacsv
~~~~ Queries a CSVs: construcción de archivos '.csv' según listado en: 'listas/CSVs_LGD_tarj_Coef_PD.xlsx' ~~~~
        --> LOG:  logs/qacsv_202402091418.log
Feb 09 14:18:00 ok_ > listas/CSVs_LGD_tarj_Coef_PD.xlsx leído correctamente:
    Periodo   Carpeta Nombre archivo CSV                    Server Base
0  202312.0  LGD_tarj        consum_mst1    172.16.1.12\MZ12 Mastercard
1       NaN       NaN        consum_mtm1  172.16.1.12\MZ12 MPS_Cautivas
2       NaN       NaN           jmtcc027    172.16.1.12\MZ12 Mastercard
Feb 09 14:18:00 ok_ > Fecha leída, Periodo: 202312.- Calculados; Fecha de corte: '20231231',
            Corte del mismo mes del año anterior: '20221231' 
Feb 09 14:18:00 inf_ Conexiones a DB a establecer:
 ['172.16.1.12\\MZ12 Mastercard' '172.16.1.12\\MZ12 MPS_Cautivas'
 '172.31.119.50 Bantotal']
Feb 09 14:18:00 inf_  DB_ Conectando con: 172.16.1.12\MZ12 Mastercard...
Feb 09 14:18:00 ok_ > DB_ Conexión con 172.16.1.12\MZ12 Mastercard ESTABLECIDA! (1 _ * 172.16.1.12\MZ12 Mastercard *)
Feb 09 14:18:00 inf_ Iniciando procesamiento de queries a 172.16.1.12\MZ12 Mastercard - 3 queries
Feb 09 14:18:00 inf_ 1 _ < consum_mst1.csv > Iniciando armado archivo 'C:/MTM_PCE_00/CVS_202312/LGD_tarj/consum_mst1.csv'
 Query:
select 
TipoRegistro, NroTarjeta, Entidad, Sucursal, NroCuenta, TipoSocio, DigitoVerific, GrupoCtaCte, NroComercio, NombreDelComercio, RamoComercio, CodMovimiento, NroCaja, NroTerminal,
NroLote, NroCupon, CantCuotas, CuotaVigente, MotContrapartida, CargoPorServicio, ConceptoAjuste, convert(datetime,FechaOperacion,121) as FechaOperacion, convert(datetime,FechaClearing,121) as FechaClearing, convert(datetime,FechaCtaCte,121) as FechaCtaCte, CodMoneda, CodMonedaOrigen, convert(float,IMonedaOrigen) as IMonedaOrigen,
convert(float,Itotal) as Itotal, convert(float,ISinDescto) as ISinDescto, convert(float,Ifinal) as Ifinal, TipoAjuste, AfectaSaldo,Aplicacion, convert(float,CprasMesAnt) as CprasMesAnt, TipoMovimiento, McaDebitoCredito
from mastercard..OpSocios where fechaOperacion>='20161001' and fechaOperacion<='20231231' and nrocuenta<=1500000 order by nrocuenta,FechaOperacion 
Feb 09 14:19:50 ok_ 1 _ < consum_mst1.csv > Creado exitosamente 'C:/MTM_PCE_00/CVS_202312/LGD_tarj/consum_mst1.csv' 
Feb 09 14:19:50 inf_ 2 _ < jmtcc027.csv > Iniciando armado archivo 'C:/MTM_PCE_00/CVS_202312/LGD_tarj/jmtcc027.csv'
 Query:
select ANIO,MES,TIPO_REGISTRO,SUCURSAL,NUM_CTA_SOCIO,COD_CONCEPTO,CANTIDAD_PESOS,convert(float,IMPORTE_PESOS) as IMPORTE_PESOS,CANTIDAD_DOLAR,convert(float,IMPORTE_DOLAR) as IMPORTE_DOLAR,Nombre_Archivo from  jmt_cc027D where cod_concepto in (9100,9300,9900,9930,10000,10400) and anio=2016 and mes in (10,11,12) union
select ANIO,MES,TIPO_REGISTRO,SUCURSAL,NUM_CTA_SOCIO,COD_CONCEPTO,CANTIDAD_PESOS,convert(float,IMPORTE_PESOS) as IMPORTE_PESOS,CANTIDAD_DOLAR,convert(float,IMPORTE_DOLAR) as IMPORTE_DOLAR,Nombre_Archivo from  jmt_cc027D where cod_concepto in (9100,9300,9900,9930,10000,10400) and anio>=2017 and anio<=2022 
union
select ANIO,MES,TIPO_REGISTRO,SUCURSAL,NUM_CTA_SOCIO,COD_CONCEPTO,CANTIDAD_PESOS,convert(float,IMPORTE_PESOS) as IMPORTE_PESOS,CANTIDAD_DOLAR,convert(float,IMPORTE_DOLAR) as IMPORTE_DOLAR,Nombre_Archivo from  jmt_cc027D where cod_concepto in (9100,9300,9900,9930,10000,10400) and anio=2023 and mes in (1,2,3,4,5,6,7,8,9,10,11,12)
order by num_cta_socio,anio,mes 
Feb 09 14:20:09 ok_ 2 _ < jmtcc027.csv > Creado exitosamente 'C:/MTM_PCE_00/CVS_202312/LGD_tarj/jmtcc027.csv' 
Feb 09 14:20:09 inf_ 3 _ < pago_mst1.csv > Iniciando armado archivo 'C:/MTM_PCE_00/CVS_202312/LGD_tarj/pago_mst1.csv'
 Query:
select ANIO,MES,TIPO_REGISTRO,SUCURSAL,NUM_CTA_SOCIO,COD_CONCEPTO,CANTIDAD_PESOS,convert(float,IMPORTE_PESOS) as IMPORTE_PESOS,CANTIDAD_DOLAR,convert(float,IMPORTE_DOLAR) as IMPORTE_DOLAR,Nombre_Archivo from mastercard..JMT_CC027D where anio=2016 and mes in (10,11,12) and cod_concepto in (16100) and nombre_archivo <>'temsmasg11.201911' union
select ANIO,MES,TIPO_REGISTRO,SUCURSAL,NUM_CTA_SOCIO,COD_CONCEPTO,CANTIDAD_PESOS,convert(float,IMPORTE_PESOS) as IMPORTE_PESOS,CANTIDAD_DOLAR,convert(float,IMPORTE_DOLAR) as IMPORTE_DOLAR,Nombre_Archivo from mastercard..JMT_CC027D where anio=2016 and mes in (10,11,12) and cod_concepto in (3100) and nombre_archivo <>'temsmasg11.201911' and importe_pesos<=0 union
select ANIO,MES,TIPO_REGISTRO,SUCURSAL,NUM_CTA_SOCIO,COD_CONCEPTO,CANTIDAD_PESOS,convert(float,IMPORTE_PESOS) as IMPORTE_PESOS,CANTIDAD_DOLAR,convert(float,IMPORTE_DOLAR) as IMPORTE_DOLAR,Nombre_Archivo from mastercard..JMT_CC027D where anio>=2017 and anio<=2022 and cod_concepto in (16100) and nombre_archivo <>'temsmasg11.201911' union
select ANIO,MES,TIPO_REGISTRO,SUCURSAL,NUM_CTA_SOCIO,COD_CONCEPTO,CANTIDAD_PESOS,convert(float,IMPORTE_PESOS) as IMPORTE_PESOS,CANTIDAD_DOLAR,convert(float,IMPORTE_DOLAR) as IMPORTE_DOLAR,Nombre_Archivo from mastercard..JMT_CC027D where anio>=2017 and anio<=2022 and cod_concepto in (3100) and nombre_archivo <>'temsmasg11.201911' and importe_pesos<=0 union
select ANIO,MES,TIPO_REGISTRO,SUCURSAL,NUM_CTA_SOCIO,COD_CONCEPTO,CANTIDAD_PESOS,convert(float,IMPORTE_PESOS) as IMPORTE_PESOS,CANTIDAD_DOLAR,convert(float,IMPORTE_DOLAR) as IMPORTE_DOLAR,Nombre_Archivo from mastercard..JMT_CC027D where anio=2023 and mes in (1,2,3,4,5,6,7,8,9,10,11,12) and cod_concepto in (16100) and nombre_archivo <>'temsmasg11.201911' union
select ANIO,MES,TIPO_REGISTRO,SUCURSAL,NUM_CTA_SOCIO,COD_CONCEPTO,CANTIDAD_PESOS,convert(float,IMPORTE_PESOS) as IMPORTE_PESOS,CANTIDAD_DOLAR,convert(float,IMPORTE_DOLAR) as IMPORTE_DOLAR,Nombre_Archivo from mastercard..JMT_CC027D where anio=2023 and mes in (1,2,3,4,5,6,7,8,9,10,11,12) and cod_concepto in (3100) and nombre_archivo <>'temsmasg11.201911' and importe_pesos<=0 
Feb 09 14:20:19 ok_ 3 _ < pago_mst1.csv > Creado exitosamente 'C:/MTM_PCE_00/CVS_202312/LGD_tarj/pago_mst1.csv' 
Feb 09 14:20:19 inf_  DB_ Conectando con: 172.16.1.12\MZ12 MPS_Cautivas...
Feb 09 14:20:20 ok_ > DB_ Conexión con 172.16.1.12\MZ12 MPS_Cautivas ESTABLECIDA! (2 _ * 172.16.1.12\MZ12 MPS_Cautivas *)
Feb 09 14:20:20 inf_ Iniciando procesamiento de queries a 172.16.1.12\MZ12 MPS_Cautivas - 2 queries
Feb 09 14:20:20 inf_ 4 _ < consum_mtm1.csv > Iniciando armado archivo 'C:/MTM_PCE_00/CVS_202312/LGD_tarj/consum_mtm1.csv'
 Query:
DECLARE @Fecha_corte date set @Fecha_corte='20231231'
DECLARE @Tabla TABLE(cta_bto INT,tip_tar varchar(10),nro_cta INT,fec_com datetime,fec_vto datetime,nro_cup int,ctd_cuo int,cod_mov int,imp_cuo decimal(18,2))
INSERT INTO @Tabla
select cta_bto,tip_tar,nro_cta,fec_com,fec_vto,nro_cup,ctd_cuo,cod_mov,convert(float,(imp_cuo)) as Importe from mps_cautivas..movtrjpro_2016_10
where fec_com between '20180101' and @Fecha_corte and cod_mov in (53,55) 
and nro_cta<=27000
DECLARE @Tabla2 TABLE(cta_bto INT,tip_tar varchar(10),nro_cta INT,fec_vto datetime,nro_cup int,ctd_cuo int,cod_mov int,imp_cuo decimal(18,2))
INSERT INTO @Tabla2
select distinct a.cta_bto,a.tip_tar,a.nro_cta,a.fec_vto-15,a.nro_cup,a.ctd_cuo,a.cod_mov,convert(float,a.imp_cuo) as Importe from mps_cautivas..movtrjpro_2016_10 a
inner join @Tabla b on a.cta_bto=b.cta_bto and a.nro_cta=b.nro_cta and a.fec_com=b.fec_com and a.nro_cup=b.nro_cup and a.ctd_cuo=b.ctd_cuo --and a.tip_tar=b.tip_tar
where a.fec_com between '20180101' and @Fecha_corte and a.cod_mov in (71) 
and a.nro_cta<=27000
DECLARE @Tabla3 TABLE(cta_bto INT,tip_tar varchar(10),nro_cta INT,fec_vto datetime,fec_com datetime,nro_cup int,ctd_cuo int,cod_mov int,imp_cuo decimal(18,2))
INSERT INTO @Tabla3
select distinct d.cta_bto,d.tip_tar,d.nro_cta,d.fec_vto,d.fec_com,d.nro_cup,d.ctd_cuo,d.cod_mov,convert(float,sum(d.imp_cuo)) as Importe from mps_cautivas..movtrjpro_2016_10 d
inner join @Tabla2 c on c.cta_bto=d.cta_bto and c.nro_cta=d.nro_cta and c.fec_vto=d.fec_vto and c.nro_cup=d.nro_cup and c.ctd_cuo=d.ctd_cuo --and c.tip_tar=d.tip_tar
where d.fec_com between '20180101' and @Fecha_corte and d.cod_mov in (21) 
and d.nro_cta<=27000
group by d.cta_bto,d.tip_tar,d.nro_cta,d.fec_vto,d.fec_com,d.nro_cup,d.ctd_cuo,d.cod_mov
DECLARE @Tabla4 TABLE(cta_bto INT,tip_tar varchar(10),nro_cta INT,fec_com datetime,nro_cup int,ctd_cuo int,cod_mov int,imp_cuo decimal(18,2))
INSERT INTO @Tabla4
select distinct a.cta_bto,a.tip_tar,a.nro_cta,a.fec_com,a.nro_cup,a.ctd_cuo,a.cod_mov,convert(float,sum(a.imp_cuo)) as Importe from mps_cautivas..movtrjpro_2016_10 a
inner join @Tabla m on a.cta_bto=m.cta_bto and a.nro_cta=m.nro_cta and a.fec_com=m.fec_com and a.fec_vto=m.fec_vto and a.nro_cup=m.nro_cup and a.ctd_cuo=m.ctd_cuo --and a.tip_tar=b.tip_tar
where a.fec_com between '20180101' and @Fecha_corte and a.cod_mov in (71) 
and a.nro_cta<=27000
group by a.cta_bto,a.tip_tar,a.nro_cta,a.fec_com,a.nro_cup,a.ctd_cuo,a.cod_mov
--
select distinct d.cta_bto,d.tip_tar,d.nro_cta,d.fec_com,d.nro_cup,d.ctd_cuo,d.cod_mov,convert(float,d.imp_cuo) as Importe from mps_cautivas..movtrjpro_2016_10 d
inner join @Tabla2 c on c.cta_bto=d.cta_bto and c.nro_cta=d.nro_cta and c.fec_vto=d.fec_vto and c.nro_cup=d.nro_cup and c.ctd_cuo=d.ctd_cuo --and c.tip_tar=d.tip_tar
where d.fec_com between '20180101' and @Fecha_corte and d.cod_mov in (21) 
and d.nro_cta<=27000
UNION
select distinct e.cta_bto,e.tip_tar,e.nro_cta,e.fec_vto,e.nro_cup,e.ctd_cuo,e.cod_mov,convert(float,e.imp_cuo) as Importe from @Tabla2 e
UNION
select cta_bto,tip_tar COLLATE Latin1_General_CI_AS ,nro_cta,fec_com,nro_cup,ctd_cuo,cod_mov,convert(float,sum(imp_cuo)) as Importe from mps_cautivas..movtrjpro_2016_10
where fec_com between '20180101' and @Fecha_corte and cod_mov in (51,52,53,54,56,57,59,60,65,68,71,73,78,79,83,87,90,92,4,6,21,22,25,26,28,29,40)
and nro_cta<=27000
group by cta_bto,tip_tar,nro_cta,fec_com,nro_cup,ctd_cuo,cod_mov
union 
select cta_bto,tip_tar COLLATE Latin1_General_CI_AS,nro_cta,fec_com,nro_cup,ctd_cuo,cod_mov,convert(float,sum(imp_cuo))  from mps_cautivas..movtrjpro_2016_10
where fec_com between '20180101' and @Fecha_corte and cod_mov in (55) and nro_cup not in (35202000,36202000,55000070,55209900) and nro_cup>=55000000
and nro_cta<=27000
group by cta_bto,tip_tar,nro_cta,fec_com,nro_cup,ctd_cuo,cod_mov
except
select g.cta_bto,g.tip_tar COLLATE Latin1_General_CI_AS ,g.nro_cta,g.fec_com,g.nro_cup,g.ctd_cuo,g.cod_mov,convert(float,sum(g.imp_cuo)) as Importe from mps_cautivas..movtrjpro_2016_10 g
inner join @Tabla2 h on g.cta_bto=h.cta_bto and g.nro_cta=h.nro_cta and g.fec_vto=h.fec_vto and g.nro_cup=h.nro_cup and g.ctd_cuo=h.ctd_cuo --and g.tip_tar=h.tip_tar
where fec_com between '20180101' and @Fecha_corte and g.cod_mov in (71)
and g.nro_cta<=27000
group by g.cta_bto,g.tip_tar,g.nro_cta,g.fec_com,g.nro_cup,g.ctd_cuo,g.cod_mov
except
select i.cta_bto,i.tip_tar COLLATE Latin1_General_CI_AS ,i.nro_cta,i.fec_com,i.nro_cup,i.ctd_cuo,i.cod_mov,convert(float,sum(i.imp_cuo)) as Importe from mps_cautivas..movtrjpro_2016_10 i
inner join @Tabla3 j on i.cta_bto=j.cta_bto and i.nro_cta=j.nro_cta and i.fec_vto=j.fec_vto and i.fec_com=j.fec_com and i.nro_cup=j.nro_cup and i.ctd_cuo=j.ctd_cuo --and i.tip_tar=h.tip_tar
where i.fec_com between '20180101' and @Fecha_corte and i.cod_mov in (21)
and i.nro_cta<=27000
group by i.cta_bto,i.tip_tar,i.nro_cta,i.fec_com,i.nro_cup,i.ctd_cuo,i.cod_mov
except
select i.cta_bto,i.tip_tar COLLATE Latin1_General_CI_AS ,i.nro_cta,i.fec_com,i.nro_cup,i.ctd_cuo,i.cod_mov,convert(float,sum(i.imp_cuo)) as Importe from mps_cautivas..movtrjpro_2016_10 i
inner join @Tabla4 o on i.cta_bto=o.cta_bto and i.nro_cta=o.nro_cta and i.fec_com=o.fec_com and i.nro_cup=o.nro_cup and i.ctd_cuo=o.ctd_cuo --and i.tip_tar=h.tip_tar
where i.fec_com between '20180101' and @Fecha_corte and i.cod_mov in (71)
and i.nro_cta<=27000
group by i.cta_bto,i.tip_tar,i.nro_cta,i.fec_com,i.nro_cup,i.ctd_cuo,i.cod_mov
order by d.cta_bto,d.tip_tar,d.nro_cta,d.fec_com,d.nro_cup,d.ctd_cuo,d.cod_mov 
Feb 09 14:23:07 err_ 4 _ < consum_mtm1.csv >ERROR en 10.d! Falló  Query a la DB
                'NoneType' object is not iterable
Feb 09 14:23:07 inf_ 5 _ < pago_mtm1.csv > Iniciando armado archivo 'C:/MTM_PCE_00/CVS_202312/LGD_tarj/pago_mtm1.csv'
 Query:
select cta_bto,tip_tar,nro_cta,convert(datetime,fec_com,121) as fec_com,nro_cup,ctd_cuo,cod_mov,convert(float,sum(imp_cuo)) as imp_cuo from mps_cautivas..movtrjpro_2016_10
where fec_com between '20180101' and '20231231' and cod_mov in (1,98) and tip_tar='PS' and nro_cta<=57845
group by cta_bto,tip_tar,nro_cta,fec_com,nro_cup,ctd_cuo,cod_mov
order by nro_cta,fec_com 
Feb 09 14:23:36 ok_ 5 _ < pago_mtm1.csv > Creado exitosamente 'C:/MTM_PCE_00/CVS_202312/LGD_tarj/pago_mtm1.csv' 
Feb 09 14:23:36 inf_  DB_ Conectando con: 172.31.119.50 Bantotal...
Feb 09 14:23:36 ok_ > DB_ Conexión con 172.31.119.50 Bantotal ESTABLECIDA! (3 _ * 172.31.119.50 Bantotal *)
Feb 09 14:23:36 inf_ Iniciando procesamiento de queries a 172.31.119.50 Bantotal - 1 queries
Feb 09 14:23:36 inf_ 6 _ < Operaciones con default.csv > Iniciando armado archivo 'C:/MTM_PCE_00/CVS_202312/Coef_PD/Operaciones con default.csv'
 Query:
select ri108emp as pgcod,ri108mod as MOD,ri108cta as CTA,ri108oper as OPER,RI108Sbop as SUBOP,convert(datetime,min(ri108fec),121) as FRI108_fec 
from fri108 where  ri108plazo>90 and ri108mod in (101,102,103,104) and ri108fec<='20231231'
group by ri108emp,ri108mod,ri108cta,ri108oper,RI108Sbop 
Feb 09 14:23:59 ok_ 6 _ < Operaciones con default.csv > Creado exitosamente 'C:/MTM_PCE_00/CVS_202312/Coef_PD/Operaciones con default.csv' 
Feb 09 14:23:59 ok_ >ok_ Se renombró listas/CSVs_LGD_tarj_Coef_PD.xlsx a listas/CSVs_LGD_tarj_Coef_PD_202402091418_err.xlsx
Feb 09 14:23:59 inf_   
                             --- RESUMEN  ---                              

Lista de CSVs a Procesar  ->  listas/CSVs_LGD_tarj_Coef_PD.xlsx                 
Archivo de LOGs           ->  logs/qacsv_202402091418.log                       
Lista CSVs Renombrada     ->  listas/CSVs_LGD_tarj_Coef_PD_202402091418_err.xlsx

 Nro. de CSVs a Procesar   Nro. de CSVs Creados    Nro. de CSVs NO creados 
            6                        5                        1            

 Nro. de CSVs Procesados   Nro. de CSVs Creados   Nro. de CSVs con Error de Procesamiento
            6                        5                        1            

# Resultado de CSVs Procesados en Conexiones Exitosas a DBs:
 - Lista de CSVs con Error de Procesamiento (1):
   1 4 _ < consum_mtm1.csv >

 - Lista de Errores de CSVs (1):
   1 4 _ < consum_mtm1.csv >ERROR en 10.d! Falló  Query a la DB
                'NoneType' object is not iterable

 - Lista de CSVs Creados (5):
   1 1 _ < consum_mst1.csv > - C:/MTM_PCE_00/CVS_202312/LGD_tarj/consum_mst1.csv
   2 2 _ < jmtcc027.csv > - C:/MTM_PCE_00/CVS_202312/LGD_tarj/jmtcc027.csv
   3 3 _ < pago_mst1.csv > - C:/MTM_PCE_00/CVS_202312/LGD_tarj/pago_mst1.csv
   4 5 _ < pago_mtm1.csv > - C:/MTM_PCE_00/CVS_202312/LGD_tarj/pago_mtm1.csv
   5 6 _ < Operaciones con default.csv > - C:/MTM_PCE_00/CVS_202312/Coef_PD/Operaciones con default.csv


# Resultado de Conexiones a DBs Consultadas:
 - Lista de conexiones a DB NO establecidas (0):

 - Lista de Errores de conexiones a DBs (0):

 - Lista de DBs Conectadas (3):
   1 1 _ * 172.16.1.12\MZ12 Mastercard *
   2 2 _ * 172.16.1.12\MZ12 MPS_Cautivas *
   3 3 _ * 172.31.119.50 Bantotal *


